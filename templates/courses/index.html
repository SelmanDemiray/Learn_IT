{% extends "base.html" %}

{% block title %}Courses - IT Learning Platform{% endblock %}

{% block content %}
<div class="courses-container">
    <div class="page-header">
        <h1>IT Learning Courses</h1>
        <p class="subtitle">Select a course to begin your learning journey</p>
        
        <div class="level-filters">
            <button class="filter-button active" onclick="filterCourses('all')">All Levels</button>
            <button class="filter-button beginner-filter" onclick="filterCourses('beginner')">Beginner</button>
            <button class="filter-button intermediate-filter" onclick="filterCourses('intermediate')">Intermediate</button>
            <button class="filter-button advanced-filter" onclick="filterCourses('advanced')">Advanced</button>
        </div>
    </div>
    
    <section class="course-section beginner-section">
        <div class="section-header">
            <h2>Beginner Courses</h2>
            <p>Perfect starting points for those new to IT</p>
        </div>
        <div class="course-grid">
            {% for course in beginner_courses %}
            <a href="/courses/{{ course.id }}" class="course-card" data-level="beginner">
                <div class="course-card-header beginner">
                    <div class="level-badge beginner">Beginner</div>
                    <div class="course-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                    </div>
                </div>
                <div class="course-card-body">
                    <h3 class="course-card-title">{{ course.title }}</h3>
                    <p class="course-card-desc">{{ course.description }}</p>
                    <div class="course-card-footer">
                        <div class="course-card-meta">
                            <div class="lesson-count">{{ course.lessons|length }} lessons</div>
                            <div class="estimated-time">~{{ course.lessons|length * 15 }} min</div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress course-{{ course.id }}" style="width: 0%" data-target-width="{% if course.progress is defined %}{{ course.progress }}{% else %}0{% endif %}%"></div>
                            </div>
                            <div class="progress-text">
                                {% if course.progress is defined and course.progress > 0 %}
                                    {% if course.progress == 100 %}Completed{% else %}{{ course.progress }}% Complete{% endif %}
                                {% else %}
                                    Not started
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="course-card-hover">
                    <span class="start-course-text">Start Course</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    
    <section class="course-section intermediate-section">
        <div class="section-header">
            <h2>Intermediate Courses</h2>
            <p>Deepen your knowledge and build practical skills</p>
        </div>
        <div class="course-grid">
            {% for course in intermediate_courses %}
            <a href="/courses/{{ course.id }}" class="course-card" data-level="intermediate">
                <div class="course-card-header intermediate">
                    <div class="level-badge intermediate">Intermediate</div>
                    <div class="course-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                    </div>
                </div>
                <div class="course-card-body">
                    <h3 class="course-card-title">{{ course.title }}</h3>
                    <p class="course-card-desc">{{ course.description }}</p>
                    <div class="course-card-footer">
                        <div class="course-card-meta">
                            <div class="lesson-count">{{ course.lessons|length }} lessons</div>
                            <div class="estimated-time">~{{ course.lessons|length * 15 }} min</div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress course-{{ course.id }}" style="width: 0%" data-target-width="{% if course.progress is defined %}{{ course.progress }}{% else %}0{% endif %}%"></div>
                            </div>
                            <div class="progress-text">
                                {% if course.progress is defined and course.progress > 0 %}
                                    {% if course.progress == 100 %}Completed{% else %}{{ course.progress }}% Complete{% endif %}
                                {% else %}
                                    Not started
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="course-card-hover">
                    <span class="start-course-text">Start Course</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    
    <section class="course-section advanced-section">
        <div class="section-header">
            <h2>Advanced Courses</h2>
            <p>Master complex concepts and specialized techniques</p>
        </div>
        <div class="course-grid">
            {% for course in advanced_courses %}
            <a href="/courses/{{ course.id }}" class="course-card" data-level="advanced">
                <div class="course-card-header advanced">
                    <div class="level-badge advanced">Advanced</div>
                    <div class="course-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path></svg>
                    </div>
                </div>
                <div class="course-card-body">
                    <h3 class="course-card-title">{{ course.title }}</h3>
                    <p class="course-card-desc">{{ course.description }}</p>
                    <div class="course-card-footer">
                        <div class="course-card-meta">
                            <div class="lesson-count">{{ course.lessons|length }} lessons</div>
                            <div class="estimated-time">~{{ course.lessons|length * 15 }} min</div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress course-{{ course.id }}" style="width: 0%" data-target-width="{% if course.progress is defined %}{{ course.progress }}{% else %}0{% endif %}%"></div>
                            </div>
                            <div class="progress-text">
                                {% if course.progress is defined and course.progress > 0 %}
                                    {% if course.progress == 100 %}Completed{% else %}{{ course.progress }}% Complete{% endif %}
                                {% else %}
                                    Not started
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="course-card-hover">
                    <span class="start-course-text">Start Course</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    
    <div class="cta-container">
        <div class="cta-card">
            <h2>Can't find what you're looking for?</h2>
            <p>Let us know what topics you'd like to learn about next!</p>
            <a href="/contact" class="btn primary">Request a Course</a>
        </div>
    </div>
</div>

{% block scripts %}
<script>
    function filterCourses(level) {
        // Update active button
        document.querySelectorAll('.level-filters .filter-button').forEach(btn => {
            btn.classList.toggle('active', btn.innerText.toLowerCase().includes(level) || (level === 'all' && btn.innerText.includes('All')));
        });
        
        // Show/hide appropriate sections
        if (level === 'all') {
            document.querySelectorAll('.course-section').forEach(section => {
                section.style.display = 'block';
            });
        } else {
            document.querySelectorAll('.course-section').forEach(section => {
                section.style.display = section.classList.contains(level + '-section') ? 'block' : 'none';
            });
        }
        
        // Apply animation to visible cards
        document.querySelectorAll('.course-section:not([style*="display: none"]) .course-card').forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 50 * index);
        });
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // Animate course cards on page load
        document.querySelectorAll('.course-card').forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 50 * index);
            
            // Mark complete courses with a checkmark
            const progress = card.querySelector('.progress');
            if (progress && progress.style.width === '100%') {
                const checkmark = document.createElement('div');
                checkmark.className = 'course-completed';
                checkmark.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
                card.appendChild(checkmark);
            }
        });
        
        // Initialize progress bars with animation
        initProgressBars();
        
        // Fetch user progress data if logged in
        fetchUserProgress();
    });
    
    function fetchUserProgress() {
        // Check if user is logged in by looking for a session cookie or token
        const isLoggedIn = document.cookie.includes('session=') || localStorage.getItem('authToken');
        
        if (isLoggedIn) {
            // In a real app, fetch actual progress from the server
            fetch('/api/user-progress')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    // Update progress bars with actual user data
                    data.courses.forEach(course => {
                        updateCourseProgress(course.id, course.progress);
                    });
                })
                .catch(error => {
                    console.error('Error fetching progress:', error);
                });
        }
    }
    
    function updateCourseProgress(courseId, percentage) {
        const progressBar = document.querySelector(`.course-${courseId}`);
        if (progressBar) {
            progressBar.style.width = `${percentage}%`;
            progressBar.setAttribute('data-target-width', `${percentage}%`);
            
            const progressText = progressBar.closest('.progress-container').querySelector('.progress-text');
            if (progressText) {
                if (percentage === 0) {
                    progressText.textContent = 'Not started';
                } else if (percentage === 100) {
                    progressText.textContent = 'Completed';
                } else {
                    progressText.textContent = `${percentage}% Complete`;
                }
            }
        }
    }
</script>
{% endblock %}
{% endblock %}
